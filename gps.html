<!DOCTYPE html>
<html>
<head>
<title>GPS Animal Detection</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="nav">
 <h2>üìç GPS Detection</h2>
 <div>
  <a href="index.html">Home</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="gps.html">GPS</a>
  <a href="mobile.html">Mobile</a>
 </div>
</div>

<div class="container">

<div class="card">
<h3>üó∫Ô∏è Location-Based Animal Detection</h3>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:20px 0;">
 <div style="padding:15px;background:#0f1b34;border-radius:10px;">
  <h4>üìç Current Location</h4>
  <div id="currentLocation">Getting GPS...</div>
  <div id="locationDetails" style="font-size:12px;color:#888;margin-top:10px;"></div>
 </div>
 <div style="padding:15px;background:#0f1b34;border-radius:10px;">
  <h4>‚ö†Ô∏è Risk Level</h4>
  <div id="riskLevel" style="font-size:24px;font-weight:bold;">CALCULATING...</div>
  <div id="riskReason" style="font-size:12px;margin-top:5px;"></div>
 </div>
</div>

<div style="margin:20px 0;">
 <button class="btn" onclick="updateLocation()">üîÑ Update Location</button>
 <button class="btn" onclick="showNearbyRisks()" style="margin-left:10px;">üó∫Ô∏è Nearby Risks</button>
 <button class="btn" onclick="reportAnimal()" style="margin-left:10px;">üìù Report Animal</button>
</div>

</div>

<div class="card">
<h3>üö® High-Risk Zones</h3>

<div id="riskZones">
 <div class="risk-zone" style="padding:10px;margin:10px 0;background:#2c1810;border-left:4px solid #ff6b6b;border-radius:5px;">
  <strong>üå≤ Forest Highway (NH-44)</strong><br>
  <small>Distance: Calculating... | Risk: HIGH | Animals: Tiger, Elephant, Deer</small>
 </div>
 <div class="risk-zone" style="padding:10px;margin:10px 0;background:#1a2c18;border-left:4px solid #ffa500;border-radius:5px;">
  <strong>ü¶å Wildlife Corridor (Gurgaon-Delhi)</strong><br>
  <small>Distance: Calculating... | Risk: MEDIUM | Animals: Nilgai, Wild Boar</small>
 </div>
 <div class="risk-zone" style="padding:10px;margin:10px 0;background:#1a1a2c;border-left:4px solid #32cd32;border-radius:5px;">
  <strong>üèûÔ∏è Rural Highway (State Road)</strong><br>
  <small>Distance: Calculating... | Risk: LOW | Animals: Cattle, Dogs</small>
 </div>
</div>

</div>

<div class="card">
<h3>üìä Location Analytics</h3>

<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;">
 <div style="text-align:center;padding:15px;background:#0f1b34;border-radius:8px;">
  <h3 style="color:#3fa3ff;margin:0;" id="speedDisplay">0</h3>
  <p style="margin:5px 0;">Speed (km/h)</p>
 </div>
 <div style="text-align:center;padding:15px;background:#0f1b34;border-radius:8px;">
  <h3 style="color:#6aff6a;margin:0;" id="accuracyDisplay">0</h3>
  <p style="margin:5px 0;">GPS Accuracy (m)</p>
 </div>
 <div style="text-align:center;padding:15px;background:#0f1b34;border-radius:8px;">
  <h3 style="color:#ff6b6b;margin:0;" id="alertCount">0</h3>
  <p style="margin:5px 0;">Alerts Today</p>
 </div>
</div>

</div>

</div>

<script>
let currentPos = null;
let watchId = null;
let alertCount = 0;

// High-risk zones database
const riskZones = [
 {
  name: "Forest Highway (NH-44)",
  lat: 28.6139, lon: 77.2090,
  radius: 5, // km
  risk: "HIGH",
  animals: ["Tiger", "Elephant", "Deer"],
  color: "#ff6b6b"
 },
 {
  name: "Wildlife Corridor (Gurgaon-Delhi)", 
  lat: 28.4595, lon: 77.0266,
  radius: 3,
  risk: "MEDIUM", 
  animals: ["Nilgai", "Wild Boar"],
  color: "#ffa500"
 },
 {
  name: "Rural Highway (State Road)",
  lat: 28.7041, lon: 77.1025,
  radius: 2,
  risk: "LOW",
  animals: ["Cattle", "Dogs"],
  color: "#32cd32"
 }
];

function initGPS() {
 if (navigator.geolocation) {
  watchId = navigator.geolocation.watchPosition(
   position => {
    currentPos = position;
    updateLocationDisplay();
    calculateRisk();
    updateNearbyRisks();
   },
   error => {
    document.getElementById('currentLocation').textContent = 'GPS Error: ' + error.message;
   },
   {
    enableHighAccuracy: true,
    maximumAge: 5000,
    timeout: 10000
   }
  );
 } else {
  document.getElementById('currentLocation').textContent = 'GPS not supported';
 }
}

function updateLocationDisplay() {
 if (!currentPos) return;
 
 const lat = currentPos.coords.latitude.toFixed(6);
 const lon = currentPos.coords.longitude.toFixed(6);
 const speed = (currentPos.coords.speed || 0) * 3.6; // m/s to km/h
 const accuracy = currentPos.coords.accuracy;
 
 document.getElementById('currentLocation').innerHTML = 
  `<strong>${lat}, ${lon}</strong>`;
 
 document.getElementById('locationDetails').textContent = 
  `Updated: ${new Date().toLocaleTimeString()}`;
 
 document.getElementById('speedDisplay').textContent = speed.toFixed(1);
 document.getElementById('accuracyDisplay').textContent = accuracy.toFixed(0);
}

function calculateRisk() {
 if (!currentPos) return;
 
 let highestRisk = "LOW";
 let riskReason = "Safe area";
 
 for (let zone of riskZones) {
  const distance = getDistance(
   currentPos.coords.latitude, 
   currentPos.coords.longitude,
   zone.lat, 
   zone.lon
  );
  
  if (distance <= zone.radius) {
   if (zone.risk === "HIGH") {
    highestRisk = "HIGH";
    riskReason = `Inside ${zone.name}`;
    // Only show risk alert, not animal alert
    showZoneWarning(zone);
    break;
   } else if (zone.risk === "MEDIUM" && highestRisk !== "HIGH") {
    highestRisk = "MEDIUM";
    riskReason = `Near ${zone.name}`;
   }
  }
 }
 
 document.getElementById('riskLevel').textContent = highestRisk;
 document.getElementById('riskLevel').style.color = 
  highestRisk === "HIGH" ? "#ff6b6b" : 
  highestRisk === "MEDIUM" ? "#ffa500" : "#32cd32";
 
 document.getElementById('riskReason').textContent = riskReason;
}

function showZoneWarning(zone) {
 // Only show zone warning, not animal detection alert
 console.log(`Zone Warning: Entered ${zone.name} - Be alert for animals`);
 
 // Gentle vibration for zone entry (different from animal detection)
 if (navigator.vibrate) {
  navigator.vibrate([100, 50, 100]); // Shorter vibration
 }
}

function getDistance(lat1, lon1, lat2, lon2) {
 const R = 6371; // Earth's radius in km
 const dLat = (lat2 - lat1) * Math.PI / 180;
 const dLon = (lon2 - lon1) * Math.PI / 180;
 const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
          Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
          Math.sin(dLon/2) * Math.sin(dLon/2);
 const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
 return R * c;
}

function updateNearbyRisks() {
 if (!currentPos) return;
 
 const riskElements = document.querySelectorAll('.risk-zone');
 
 riskZones.forEach((zone, index) => {
  const distance = getDistance(
   currentPos.coords.latitude,
   currentPos.coords.longitude, 
   zone.lat,
   zone.lon
  );
  
  const element = riskElements[index];
  const small = element.querySelector('small');
  small.innerHTML = `Distance: ${distance.toFixed(1)} km | Risk: ${zone.risk} | Animals: ${zone.animals.join(', ')}`;
 });
}

function updateLocation() {
 document.getElementById('currentLocation').textContent = 'Updating...';
 initGPS();
}

function showNearbyRisks() {
 if (!currentPos) {
  alert('GPS location not available');
  return;
 }
 
 let message = 'üó∫Ô∏è Nearby Risk Zones:\n\n';
 
 riskZones.forEach(zone => {
  const distance = getDistance(
   currentPos.coords.latitude,
   currentPos.coords.longitude,
   zone.lat, 
   zone.lon
  );
  
  message += `${zone.name}\n`;
  message += `Distance: ${distance.toFixed(1)} km\n`;
  message += `Risk: ${zone.risk}\n`;
  message += `Animals: ${zone.animals.join(', ')}\n\n`;
 });
 
 alert(message);
}

function reportAnimal() {
 if (!currentPos) {
  alert('GPS location required to report animal sighting');
  return;
 }
 
 const animal = prompt('Which animal did you see?\n(Tiger, Elephant, Deer, Cow, etc.)');
 if (animal) {
  const lat = currentPos.coords.latitude.toFixed(6);
  const lon = currentPos.coords.longitude.toFixed(6);
  
  alert(`üêæ Animal Report Submitted!\n\nAnimal: ${animal}\nLocation: ${lat}, ${lon}\nTime: ${new Date().toLocaleString()}\n\nThank you for helping wildlife conservation!`);
  
  // In real app, this would send to server
  console.log('Animal report:', { animal, lat, lon, time: new Date() });
 }
}

// Initialize GPS on page load
window.onload = function() {
 initGPS();
};

// Cleanup on page unload
window.onbeforeunload = function() {
 if (watchId) {
  navigator.geolocation.clearWatch(watchId);
 }
};
</script>

</body>
</html>